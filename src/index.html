<!doctype html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8">
  <title>MinuteMail - Temporary Email Address</title>
  <base href="/">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MinuteMail">

  <meta name="description" content="Get a temporary, disposable email address that expires automatically. Perfect for signups, downloads, and protecting your privacy.">
  <meta name="keywords" content="temporary email, disposable email, privacy, anonymous email, minutemail">
  <meta name="author" content="MinuteMail">

  <!-- Security Headers -->
  <meta http-equiv="Content-Security-Policy"
        content="
      default-src 'self';
      img-src 'self' data: https:;
      style-src 'self' 'unsafe-inline';
      script-src 'self' 'unsafe-inline' https://monitoring.minutemail.co;
      connect-src 'self' https://api.minutemail.co https://monitoring.minutemail.co https://keycloak.minutemail.co wss://localhost:*;
      frame-src   'self' https://keycloak.minutemail.co;
    ">

  <meta http-equiv="Referrer-Policy" content="no-referrer">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <!-- Theme Color -->
  <meta name="theme-color" content="#24c8db">
  <meta name="msapplication-TileColor" content="#24c8db">

  <!-- Open Graph -->
  <meta property="og:title" content="MinuteMail - Temporary Email Address">
  <meta property="og:description" content="Get a temporary, disposable email address that expires automatically. Perfect for signups, downloads, and protecting your privacy.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://minutemail.co">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="MinuteMail - Temporary Email Address">
  <meta name="twitter:description" content="Get a temporary, disposable email address that expires automatically.">

  <!-- Preload critical resources -->
  <link rel="preconnect" href="https://minutemail.co">
  <link rel="preconnect" href="https://api.minutemail.co">

  <!-- Critical CSS for theme initialization and SSR -->
  <style>
    /* FAQ JSON-LD structured data for Google */
  </style>

  <!-- FAQ Structured Data for Google -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "How long does a MinuteMail disposable inbox last?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Each inbox self-destructs exactly 60 minutes after creation—no action required. Custom expiry options are planned for the near future."
          }
        },
        {
          "@type": "Question",
          "name": "Does MinuteMail store any of my emails or logs?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Messages are kept in memory only. Once the 60-minute timer ends, all data is wiped. We keep zero server logs—no IPs, user agents, or tracking cookies."
          }
        },
        {
          "@type": "Question",
          "name": "Can I receive and download attachments with MinuteMail?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes. We accept common file types and show a download link right in the inbox. The current soft limit is 10 MB per email."
          }
        },
        {
          "@type": "Question",
          "name": "Does MinuteMail provide an API for developers?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Absolutely—everything in the UI is available via REST. Visit our API page for full docs or import our Postman collection to automate inbox creation and message retrieval."
          }
        },
        {
          "@type": "Question",
          "name": "Can I use my own domain with MinuteMail?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Coming soon! You'll be able to point your MX record at MinuteMail and run disposable addresses under your own domain (e.g., you@yourdomain.com). Perfect for power users and dev teams."
          }
        }
      ]
    }

  </script>

  <style>
    /* Prevent flash of unstyled content */
    :root {
      --primary-color: #24c8db;
      --background-color: #0d1117;
      --surface-color: #161b22;
      --text-color: #e6edf3;
      --text-muted: #8b949e;
      --border-color: #30363d;
    }

    html {
      background-color: var(--background-color);
      color: var(--text-color);
      transition: none !important; /* Prevent transition flashing */
      /* Force proper mobile rendering */
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
      text-size-adjust: 100%;
      /* CRITICAL: Ensure scrolling works on all devices */
      overflow-y: auto !important;
      height: auto !important;
      -webkit-overflow-scrolling: touch !important;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      transition: none !important; /* Prevent transition flashing */
      min-height: 100vh;
      /* Improve text rendering on mobile */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      /* Prevent iOS zoom on input focus */
      font-size: 16px;
      /* CRITICAL: Ensure body can scroll */
      overflow-y: auto !important;
      height: auto !important;
      -webkit-overflow-scrolling: touch !important;
      /* Disable iOS bounce scrolling */
      overscroll-behavior: none;
    }

    /* Ensure app root takes full height */
    app-root {
      display: block;
      min-height: 100vh;
      /* CRITICAL: Don't restrict scrolling */
      overflow-y: visible !important;
      height: auto !important;
    }

    /* Loading state */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--background-color);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.3s ease;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(36, 200, 219, 0.3);
      border-top: 3px solid #24c8db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Hide loading screen when app is ready */
    app-root:not(:empty) + .loading-screen {
      opacity: 0;
      pointer-events: none;
    }

    /* Ensure proper modal positioning for SSR */
    .mail-viewer-overlay {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      z-index: 9999 !important;
    }

    /* Prevent theme transition flashing */
    .no-transition * {
      transition: none !important;
    }

    /* CRITICAL MOBILE FIXES - Apply immediately */
    @media screen and (max-width: 768px) {
      html, body {
        overflow-y: auto !important;
        height: auto !important;
        -webkit-overflow-scrolling: touch !important;
        /* Prevent any potential overflow hidden */
        overflow-x: visible !important;
      }

      /* Force mobile styles */
      .hidden.md\\:grid {
        display: none !important;
      }

      .md\\:grid {
        display: none !important;
      }

      /* Ensure proper font sizes */
      body {
        font-size: 16px !important;
      }

      /* Improve touch targets */
      button, [role="button"], a {
        min-height: 44px;
        min-width: 44px;
      }
    }

    /* iOS specific fixes - Apply immediately */
    @supports (-webkit-touch-callout: none) {
      /* iOS Safari specific styles */
      html, body {
        /* CRITICAL: Force scrolling on iOS */
        overflow-y: auto !important;
        height: auto !important;
        -webkit-overflow-scrolling: touch !important;
      }

      body {
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
      }

      input, textarea, [contenteditable] {
        -webkit-user-select: text;
        user-select: text;
      }

      /* Prevent iOS zoom */
      input[type="text"], input[type="email"], textarea {
        font-size: 16px !important;
      }

      /* Force mobile styles on iOS */
      .hidden.md\\:grid,
      .md\\:grid {
        display: none !important;
      }
    }

    /* EMERGENCY OVERRIDE - Last resort for stubborn devices */
    @media screen and (max-width: 768px) {
      * {
        /* Remove any potential max-height restrictions */
        max-height: none !important;
      }

      /* Force all containers to allow scrolling */
      .min-h-screen, main, .max-w-4xl, .max-w-5xl {
        height: auto !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch !important;
      }
    }
  </style>
</head>
<body>
  <app-root></app-root>

  <!-- Loading screen fallback -->
  <div class="loading-screen">
    <div class="loading-spinner"></div>
  </div>

  <!-- Enhanced theme initialization script with iOS support -->
  <script>
    // Helper function to get cookie value
    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // Detect mobile device
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
             window.innerWidth <= 768 ||
             (window.screen && window.screen.width <= 768);
    }

    // Force mobile styles if needed
    function forceMobileStyles() {
      if (isMobileDevice()) {
        document.documentElement.classList.add('mobile-device');
        // Add CSS to force mobile styles
        const style = document.createElement('style');
        style.textContent = `
          .hidden.md\\:grid,
          .md\\:grid {
            display: none !important;
          }

          @media screen and (max-width: 768px) {
            .hidden.md\\:grid,
            .md\\:grid {
              display: none !important;
            }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // CRITICAL: Fix mobile scrolling immediately
    function fixMobileScrolling() {
      if (isMobileDevice()) {
        // Force scrolling on html and body using type assertion
        const htmlStyle = document.documentElement.style;
        const bodyStyle = document.body.style;

        htmlStyle.overflowY = 'auto';
        htmlStyle.height = 'auto';
        htmlStyle.setProperty('-webkit-overflow-scrolling', 'touch');

        bodyStyle.overflowY = 'auto';
        bodyStyle.height = 'auto';
        bodyStyle.setProperty('-webkit-overflow-scrolling', 'touch');

        // Remove any potential overflow hidden that might be set later
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
              const target = mutation.target;
              if (target === document.body || target === document.documentElement) {
                const targetStyle = target.style;
                if (targetStyle.overflow === 'hidden' || targetStyle.overflowY === 'hidden') {
                  targetStyle.overflowY = 'auto';
                  targetStyle.setProperty('-webkit-overflow-scrolling', 'touch');
                }
              }
            }
          });
        });

        observer.observe(document.body, { attributes: true, attributeFilter: ['style'] });
        observer.observe(document.documentElement, { attributes: true, attributeFilter: ['style'] });
      }
    }

    // Immediately apply saved theme or default to dark
    (function() {
      try {
        const html = document.documentElement;
        const body = document.body;

        // Add no-transition class to prevent flashing
        html.classList.add('no-transition');
        body.classList.add('no-transition');

        // Always apply dark mode
        html.classList.add('dark');
        body.classList.add('dark');

        // Force mobile styles
        forceMobileStyles();

        // CRITICAL: Fix mobile scrolling
        fixMobileScrolling();

        // Force a reflow to ensure styles are applied
        html.offsetHeight;

        // Remove no-transition class after a short delay
        setTimeout(() => {
          html.classList.remove('no-transition');
          body.classList.remove('no-transition');
        }, 50);
      } catch (e) {
        console.warn('Theme initialization error:', e);
        // Always fallback to dark mode
        document.documentElement.classList.add('dark');
        document.body.classList.add('dark');
        forceMobileStyles();
        fixMobileScrolling();
      }
    })();

    // Handle Keycloak cross-site cookie issues
    // Set document.domain if on same parent domain (not applicable here)
    // Add error handling for cross-site requests
    window.addEventListener('unhandledrejection', function(event) {
      if (event.reason && event.reason.message && event.reason.message.includes('CORS')) {
        console.warn('CORS error detected, this may be related to Keycloak cross-site issues');
        // Don't prevent default - let the error be handled normally
      }
    });

    // Additional iOS fixes
    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
      // CRITICAL: Prevent iOS from blocking scrolling
      document.addEventListener('touchstart', function() {}, { passive: true });
      document.addEventListener('touchmove', function(e) {
        // Only prevent default if we're not in a scrollable container
        const target = e.target;
        const scrollableParent = target.closest('.overflow-y-auto, .overflow-auto, main, .mobile-scroll-container, .mobile-scroll-content');
        if (!scrollableParent) {
          // Allow scrolling on the main document
          if (target === document.body || target === document.documentElement) {
            return;
          }
          e.preventDefault();
        }
      }, { passive: false });

      // Fix iOS viewport issues
      function fixIOSViewport() {
        const viewport = document.querySelector('meta[name="viewport"]');
        if (viewport) {
          viewport.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover');
        }

        // Force scrolling again after viewport change
        document.documentElement.style.overflowY = 'auto';
        document.body.style.overflowY = 'auto';
      }

      // Apply fix on load and orientation change
      window.addEventListener('load', fixIOSViewport);
      window.addEventListener('orientationchange', function() {
        setTimeout(fixIOSViewport, 100);
        setTimeout(fixMobileScrolling, 200);
      });
    }

    // Monitor for any changes that might break scrolling
    window.addEventListener('load', function() {
      if (isMobileDevice()) {
        // Double-check scrolling is working after page load
        setTimeout(fixMobileScrolling, 500);

        // Set up periodic check for the first few seconds
        let checkCount = 0;
        const checkInterval = setInterval(function() {
          fixMobileScrolling();
          checkCount++;
          if (checkCount >= 10) { // Check for 5 seconds
            clearInterval(checkInterval);
          }
        }, 500);
      }
    });
  </script>
</body>
</html>
